Vagrant.configure("2") do |config|

  workers_count = 1

  config.vm.define "monitoring" do |monitoring|
    central.vm.box = "centos/7"
    central.vm.hostname = "monitoring"
    central.vm.network :private_network, ip: "192.168.55.252"

    config.vm.provision "ansible" do |ansible|
      ansible.playbook = "ansible/monitoring.yml"
      ansible.become = true
      ansible.groups = { 'monitoring' => ['monitoring'] }
    end

  end

  config.vm.define "central" do |central|
    central.vm.box = "centos/7"
    central.vm.hostname = "monitoring"
    central.vm.network :private_network, ip: "192.168.55.254"

    config.vm.provision "ansible" do |ansible|
      ansible.playbook = "ansible/monitoring.yml"
      ansible.become = true
      ansible.groups = { 'monitoring' => ['monitoring'] }
    end

  end

  (1..workers_count).each do |i|
    config.vm.define "worker#{i}" do |worker|
      worker.vm.box = "centos/7"
      worker.vm.hostname = "worker#{i}"
      # making sure that we don't receive address 55.1
      i += 1
      worker.vm.network :private_network, ip: "192.168.55.#{i}"
    end

    config.vm.provision "ansible" do |ansible|
      ansible.playbook = "ansible/worker.yml"
      ansible.become = true
      ansible.groups = {
          'workers' => [
              "worker#{i}"
          ]
      }
    end
  end

end
